#include <mach/mt_typedefs.h>

#define TEMPERATURE_T0                  110
#define TEMPERATURE_T1                  0
#define TEMPERATURE_T2                  25
#define TEMPERATURE_T3                  50
#define TEMPERATURE_T                   255 // This should be fixed, never change the value

#define FG_METER_RESISTANCE 	0

#define MAX_BOOTING_TIME_FGCURRENT	1*10 // 10s

#if defined(CONFIG_POWER_EXT)
#define OCV_BOARD_COMPESATE	72 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
#else
#define OCV_BOARD_COMPESATE	0 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
#endif

#define Q_MAX_POS_50	2055
#define Q_MAX_POS_25	2038
#define Q_MAX_POS_0		1896
#define Q_MAX_NEG_10	1536

#define Q_MAX_POS_50_H_CURRENT	2040
#define Q_MAX_POS_25_H_CURRENT	2022
#define Q_MAX_POS_0_H_CURRENT	1835
#define Q_MAX_NEG_10_H_CURRENT	1423

#define R_FG_VALUE 				20 // mOhm, base is 20
#define CURRENT_DETECT_R_FG	10  //1mA

#define OSR_SELECT_7			0

#define CAR_TUNE_VALUE			93 //1.00

/////////////////////////////////////////////////////////////////////
// <DOD, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _BATTERY_PROFILE_STRUC
{
    kal_int32 percentage;
    kal_int32 voltage;
} BATTERY_PROFILE_STRUC, *BATTERY_PROFILE_STRUC_P;

typedef enum
{
    T1_0C,
    T2_25C,
    T3_50C
} PROFILE_TEMPERATURE;

// T0 -10C
BATTERY_PROFILE_STRUC battery_profile_t0[] =
{
{	0	,	4188	},
{	2	,	4173	},
{	3	,	4165	},
{	5	,	4150	},
{	7	,	4135	},
{	8	,	4127	},
{	10	,	4112	},
{	11	,	4104	},
{	13	,	4089	},
{	15	,	4074	},
{	16	,	4066	},
{	18	,	4051	},
{	20	,	4035	},
{	21	,	4028	},
{	23	,	4013	},
{	25	,	3997	},
{	26	,	3990	},
{	28	,	3974	},
{	30	,	3959	},
{	31	,	3951	},
{	33	,	3936	},
{	34	,	3929	},
{	36	,	3913	},
{	38	,	3898	},
{	39	,	3890	},
{	41	,	3875	},
{	43	,	3860	},
{	44	,	3852	},
{	46	,	3837	},
{	48	,	3822	},
{	49	,	3814	},
{	51	,	3799	},
{	52	,	3791	},
{	54	,	3776	},
{	56	,	3761	},
{	57	,	3753	},
{	59	,	3738	},
{	61	,	3723	},
{	62	,	3715	},
{	64	,	3700	},
{	66	,	3684	},
{	67	,	3677	},
{	69	,	3662	},
{	71	,	3646	},
{	72	,	3639	},
{	74	,	3623	},
{	75	,	3616	},
{	76	,	3608	},
{	77	,	3600	},
{	79	,	3585	},
{	80	,	3578	},
{	82	,	3562	},
{	83	,	3555	},
{	85	,	3539	},
{	86	,	3532	},
{	88	,	3517	},
{	89	,	3509	},
{	91	,	3494	},
{	92	,	3486	},
{	94	,	3471	},
{	95	,	3463	},
{	96	,	3456	},
{	97	,	3448	},
{	98	,	3440	},
{	99	,	3433	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	}
};      
        
// T1 0C 
BATTERY_PROFILE_STRUC battery_profile_t1[] =
{
{	0	,	4198	},
{	2	,	4183	},
{	3	,	4175	},
{	5	,	4159	},
{	7	,	4144	},
{	8	,	4136	},
{	10	,	4121	},
{	11	,	4113	},
{	13	,	4098	},
{	15	,	4082	},
{	16	,	4074	},
{	18	,	4059	},
{	20	,	4043	},
{	21	,	4036	},
{	23	,	4020	},
{	25	,	4005	},
{	26	,	3997	},
{	28	,	3982	},
{	30	,	3966	},
{	31	,	3958	},
{	33	,	3943	},
{	34	,	3935	},
{	36	,	3920	},
{	38	,	3904	},
{	39	,	3897	},
{	41	,	3881	},
{	43	,	3866	},
{	44	,	3858	},
{	46	,	3842	},
{	48	,	3827	},
{	49	,	3819	},
{	51	,	3804	},
{	52	,	3796	},
{	54	,	3781	},
{	56	,	3765	},
{	57	,	3757	},
{	59	,	3742	},
{	61	,	3726	},
{	62	,	3719	},
{	64	,	3703	},
{	66	,	3688	},
{	67	,	3680	},
{	69	,	3665	},
{	71	,	3649	},
{	72	,	3641	},
{	74	,	3626	},
{	75	,	3618	},
{	76	,	3611	},
{	77	,	3603	},
{	79	,	3587	},
{	80	,	3580	},
{	82	,	3564	},
{	83	,	3556	},
{	85	,	3541	},
{	86	,	3533	},
{	88	,	3518	},
{	89	,	3510	},
{	91	,	3495	},
{	92	,	3487	},
{	94	,	3471	},
{	95	,	3464	},
{	96	,	3456	},
{	97	,	3448	},
{	98	,	3440	},
{	99	,	3433	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	},
{	100	,	3425	}
};           

// T2 25C
BATTERY_PROFILE_STRUC battery_profile_t2[] =
{
{	0	,	4080	},
{	2	,	4066	},
{	3	,	4060	},
{	5	,	4046	},
{	7	,	4032	},
{	8	,	4026	},
{	10	,	4012	},
{	11	,	4005	},
{	13	,	3992	},
{	15	,	3978	},
{	16	,	3971	},
{	18	,	3958	},
{	20	,	3944	},
{	21	,	3937	},
{	23	,	3924	},
{	25	,	3910	},
{	26	,	3903	},
{	28	,	3890	},
{	30	,	3876	},
{	31	,	3869	},
{	33	,	3856	},
{	34	,	3849	},
{	36	,	3835	},
{	38	,	3822	},
{	39	,	3815	},
{	41	,	3801	},
{	43	,	3788	},
{	44	,	3781	},
{	46	,	3767	},
{	48	,	3754	},
{	49	,	3747	},
{	51	,	3733	},
{	52	,	3726	},
{	54	,	3713	},
{	56	,	3699	},
{	57	,	3692	},
{	59	,	3679	},
{	61	,	3665	},
{	62	,	3658	},
{	64	,	3645	},
{	66	,	3631	},
{	67	,	3624	},
{	69	,	3611	},
{	71	,	3597	},
{	72	,	3590	},
{	74	,	3577	},
{	75	,	3570	},
{	77	,	3556	},
{	79	,	3543	},
{	80	,	3536	},
{	82	,	3522	},
{	84	,	3509	},
{	85	,	3502	},
{	87	,	3488	},
{	89	,	3475	},
{	90	,	3468	},
{	92	,	3454	},
{	94	,	3441	},
{	95	,	3434	},
{	97	,	3420	},
{	98	,	3414	},
{	98	,	3414	},
{	99	,	3407	},
{	99	,	3407	},
{	99	,	3407	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	},
{	100	,	3400	}

};     

// T3 50C
BATTERY_PROFILE_STRUC battery_profile_t3[] =
{
{	0	,	4188	},
{	2	,	4172	},
{	3	,	4165	},
{	5	,	4149	},
{	7	,	4134	},
{	8	,	4126	},
{	10	,	4110	},
{	11	,	4103	},
{	13	,	4087	},
{	15	,	4071	},
{	16	,	4064	},
{	18	,	4048	},
{	20	,	4033	},
{	21	,	4025	},
{	23	,	4009	},
{	25	,	3994	},
{	26	,	3986	},
{	28	,	3970	},
{	30	,	3955	},
{	31	,	3947	},
{	33	,	3932	},
{	34	,	3924	},
{	36	,	3908	},
{	38	,	3893	},
{	39	,	3885	},
{	41	,	3869	},
{	43	,	3854	},
{	44	,	3846	},
{	46	,	3831	},
{	48	,	3815	},
{	49	,	3807	},
{	51	,	3792	},
{	52	,	3784	},
{	54	,	3768	},
{	56	,	3753	},
{	57	,	3745	},
{	59	,	3730	},
{	61	,	3714	},
{	62	,	3706	},
{	64	,	3691	},
{	66	,	3675	},
{	67	,	3667	},
{	69	,	3652	},
{	71	,	3636	},
{	72	,	3629	},
{	74	,	3613	},
{	75	,	3605	},
{	76	,	3597	},
{	77	,	3590	},
{	79	,	3574	},
{	80	,	3566	},
{	82	,	3551	},
{	83	,	3543	},
{	85	,	3528	},
{	86	,	3520	},
{	88	,	3504	},
{	89	,	3496	},
{	91	,	3481	},
{	92	,	3473	},
{	94	,	3458	},
{	95	,	3450	},
{	96	,	3442	},
{	97	,	3434	},
{	98	,	3427	},
{	99	,	3419	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	},
{	100	,	3411	}
};           

// battery profile for actual temperature. The size should be the same as T1, T2 and T3
BATTERY_PROFILE_STRUC battery_profile_temperature[] =
{
  	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 }
};      

/////////////////////////////////////////////////////////////////////
// <Rbat, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _R_PROFILE_STRUC
{
    kal_int32 resistance; // Ohm
    kal_int32 voltage;
} R_PROFILE_STRUC, *R_PROFILE_STRUC_P;

// T0 -10C
R_PROFILE_STRUC r_profile_t0[] =
{
	{358 , 4193},
	{513 , 4174},
	{520 , 4157},
	{523 , 4140},
	{528 , 4124},
	{533 , 4109},
	{530 , 4093},
	{538 , 4081},
	{540 , 4068},
	{540 , 4051},
	{543 , 4031},
	{538 , 4010},
	{538 , 3993},
	{538 , 3980},
	{538 , 3968},
	{533 , 3956},
	{530 , 3945},  
	{523 , 3933}, 
	{518 , 3921},
	{515 , 3909},
	{513 , 3898},  
	{513 , 3887},
	{510 , 3877},
	{510 , 3867},
	{508 , 3858},
	{510 , 3850},
	{510 , 3842},
	{510 , 3834},
	{510 , 3827},
	{515 , 3821},
	{518 , 3815},
	{520 , 3809},
	{523 , 3804},
	{525 , 3798},
	{528 , 3794},
	{530 , 3789},
	{535 , 3785},
	{535 , 3781},
	{538 , 3777},
	{540 , 3774},
	{543 , 3771},
	{545 , 3769},
	{548 , 3766},
	{545 , 3763},
	{548 , 3759},
	{548 , 3755},
	{550 , 3751},
	{555 , 3747},
	{555 , 3742},
	{558 , 3736},
	{563 , 3730},
	{563 , 3722},  
	{573 , 3715},
	{585 , 3709},
	{610 , 3704},
	{643 , 3698},
	{698 , 3690},
	{775 , 3673},
	{898 , 3639},
	{1180, 3585},
	{1353, 3540},
	{1280, 3512},
	{1228, 3489},
	{1180, 3469},
	{1143, 3451},
	{1105, 3437},
	{1070, 3424},
	{1050, 3412},
	{1023, 3402},
	{990 , 3392},
	{965 , 3384},
	{943 , 3376},
	{933 , 3369},
	{918 , 3363},
	{905 , 3357},
	{900 , 3350},
	{878 , 3345},
	{855 , 3340},
	{855 , 3337},
	{840 , 3332},
	{860 , 3332}
};      

// T1 0C
R_PROFILE_STRUC r_profile_t1[] =
{
	{260, 4198},
	{320, 4179},
	{328, 4162},
	{330, 4145},
	{335, 4129},
	{340, 4114},
	{343, 4098},
	{345, 4084},
	{353, 4072},
	{355, 4058},
	{358, 4040},
	{358, 4021},
	{360, 4005},
	{360, 3992},
	{363, 3981},
	{363, 3970},
	{360, 3958},  
	{360, 3947}, 
	{355, 3934},
	{345, 3920},
	{343, 3908},  
	{340, 3896},
	{333, 3884},
	{328, 3873},
	{325, 3863},
	{325, 3854},
	{325, 3846},
	{325, 3838},
	{323, 3830},
	{325, 3824},
	{328, 3818},
	{328, 3812},
	{333, 3807},
	{333, 3802},
	{333, 3797},
	{335, 3793},
	{340, 3789},
	{338, 3785},
	{343, 3782},
	{343, 3779},
	{343, 3776},
	{343, 3773},
	{348, 3771},
	{345, 3768},
	{343, 3764},
	{348, 3762},
	{345, 3757},
	{348, 3753},
	{350, 3749},
	{350, 3743},
	{350, 3736},
	{353, 3730},  
	{353, 3722},
	{353, 3713},
	{353, 3704},
	{360, 3698},
	{380, 3694},
	{410, 3688},
	{445, 3673},
	{465, 3627},
	{545, 3549},
	{848, 3425},
	{880, 3350},
	{773, 3305},
	{703, 3275},
	{648, 3253},
	{608, 3238},
	{578, 3224},
	{555, 3215},
	{525, 3205},
	{510, 3199},
	{488, 3194},
	{488, 3188},
	{468, 3183},
	{460, 3180},
	{463, 3174},
	{450, 3170},
	{453, 3166},
	{420, 3164},
	{423, 3164},
	{428, 3164}
};     

// T2 25C
R_PROFILE_STRUC r_profile_t2[] =
{
	{158, 4184},
	{160, 4166},
	{163, 4150},
	{165, 4136},
	{168, 4122},
	{170, 4109},
	{170, 4095},
	{173, 4082},
	{173, 4070},
	{175, 4058},
	{178, 4046},
	{178, 4033},
	{180, 4021},
	{183, 4009},
	{185, 3999},
	{185, 3988},
	{190, 3979},  
	{193, 3969}, 
	{193, 3959},
	{195, 3950},
	{198, 3941},  
	{198, 3932},
	{195, 3923},
	{195, 3913},
	{198, 3904},
	{195, 3893},
	{185, 3880},
	{175, 3867},
	{168, 3855},
	{160, 3846},
	{158, 3838},
	{155, 3831},
	{153, 3824},
	{155, 3819},
	{158, 3814},
	{160, 3810},
	{158, 3805},
	{160, 3801},
	{160, 3797},
	{158, 3793},
	{158, 3789},
	{160, 3786},
	{160, 3783},
	{163, 3780},
	{165, 3778},
	{163, 3775},
	{165, 3773},
	{163, 3770},
	{163, 3767},
	{155, 3761},
	{155, 3757},
	{155, 3752},  
	{153, 3746},
	{153, 3741},
	{155, 3737},
	{155, 3733},
	{158, 3729},
	{155, 3722},
	{153, 3715},
	{158, 3709},
	{158, 3702},
	{158, 3693},
	{153, 3684},
	{155, 3681},
	{163, 3678},
	{170, 3674},
	{175, 3663},
	{173, 3625},
	{180, 3564},
	{193, 3478},
	{223, 3343},
	{208, 3281},
	{165, 3266},
	{170, 3266},
	{170, 3266},
	{170, 3266},
	{170, 3266},
	{170, 3266},
	{170, 3266},
	{170, 3266},
	{170, 3266}     
}; 

// T3 50C
R_PROFILE_STRUC r_profile_t3[] =
{
	{138, 4188},
	{143, 4172},
	{143, 4156},
	{143, 4141},
	{143, 4126},
	{145, 4113},
	{145, 4099},
	{145, 4085},
	{145, 4073},
	{148, 4060},
	{148, 4048},
	{148, 4036},
	{150, 4024},
	{150, 4012},
	{150, 4001},
	{150, 3990},
	{153, 3980},  
	{153, 3969}, 
	{153, 3959},
	{155, 3949},
	{155, 3939},  
	{158, 3930},
	{163, 3922},
	{165, 3913},
	{165, 3903},
	{168, 3895},
	{168, 3886},
	{163, 3874},
	{155, 3860},
	{148, 3849},
	{145, 3839},
	{148, 3832},
	{148, 3825},
	{145, 3819},
	{145, 3813},
	{145, 3808},
	{145, 3803},
	{148, 3799},
	{150, 3796},
	{145, 3791},
	{148, 3788},
	{150, 3785},
	{153, 3782},
	{150, 3778},
	{155, 3776},
	{155, 3773},
	{155, 3770},
	{158, 3768},
	{155, 3764},
	{148, 3756},
	{140, 3746},
	{143, 3741},  
	{143, 3735},
	{143, 3729},
	{143, 3725},
	{143, 3720},
	{148, 3717},
	{145, 3712},
	{145, 3705},
	{145, 3698},
	{145, 3692},
	{148, 3685},
	{143, 3674},
	{145, 3669},
	{150, 3667},
	{153, 3663},
	{158, 3657},
	{153, 3634},
	{158, 3585},
	{160, 3515},
	{165, 3411},
	{183, 3273},
	{150, 3260},
	{153, 3260},
	{153, 3260},
	{153, 3260},
	{153, 3260},
	{153, 3260},
	{153, 3260},
	{153, 3260},
	{153, 3260} 
}; 

// r-table profile for actual temperature. The size should be the same as T1, T2 and T3
R_PROFILE_STRUC r_profile_temperature[] =
{
 	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },  
	{0  , 0 }, 
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },  
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 }
};      


int fgauge_get_saddles(void);
BATTERY_PROFILE_STRUC_P fgauge_get_profile(kal_uint32 temperature);

int fgauge_get_saddles_r_table(void);
R_PROFILE_STRUC_P fgauge_get_profile_r_table(kal_uint32 temperature);

//#define CONFIG_POWER_VERIFY